---
title: "sql_class"
format: html
editor: visual
---

# Load packages
```{r}
library(DBI)
library(RSQLite)
library(tidyverse)

# Create or connect to a SQLite database
con <- dbConnect(RSQLite::SQLite(), dbname = "my_db.sqlite")
```


```{r}
# Make the connection available to SQL chunks
knitr::knit_engines$set(sql = function(options) {
  DBI::dbGetQuery(con, options$code)
})
```


```{r}
# Write iris data frame into the database
dbWriteTable(con, "iris", iris, overwrite = TRUE)

# Run SQL query
result <- dbGetQuery(con, "SELECT Species, AVG(`Sepal.Length`) as Avg_Sepal
  FROM iris
  GROUP BY Species")

print(result)

# Close connection
dbDisconnect(con)
```
```{r}
# Access table using dplyr (this is a lazy dbplyr table)
iris_tbl <- tbl(con, "iris")
```
